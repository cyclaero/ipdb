<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1404.47">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'SourceCodePro'}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'SourceCodePro'; min-height: 14.0px}
    span.s1 {font-variant-ligatures: no-common-ligatures}
    span.s2 {text-decoration: underline ; font-variant-ligatures: no-common-ligatures}
    @font-face {
      font-family: SourceCodePro;
      font-style: normal;
      font-weight: 400;
      src: url('SourceCodePro-Regular.ttf.woff') format('woff');
    }
  </style>
</head>
<body>
<p class="p1"><span class="s1"><A href="https://github.com/cyclaero/ipdb">ipdbtools(1)</A><span class="space">              </span>BSD General Commands Manual <span class="space">            </span><A href="https://github.com/cyclaero/ipdb">ipdbtools(1)</A></span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><b>NAME</b></span></p>
<p class="p1"><span class="s1"><span class="space">     </span><b>ipup</b> <b>-</b> <b>ipdb</b> <b>-</b> <b>ipdb-update.sh</b> -- Tools for generating IP based Geo-block-</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>ing and Geo-routing tables in order to configure the system's firewall</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>and/or routing facilities</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><b>SYNOPSIS</b></span></p>
<p class="p1"><span class="s1"><span class="space">     </span><b>ipup</b> [<b>-h</b>] [<b>-r</b> </span><span class="s2">bstfiles</span><span class="s1">] &lt;</span><span class="s2">IP_address</span><span class="s1">&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span><b>ipup</b> [<b>-h</b>] <b>-t</b> </span><span class="s2">CC:DD:..</span><span class="s1"> | </span><span class="s2">CC=nnnnn:DD=mmmmm:..</span><span class="s1"> | </span><span class="s2">""</span><span class="s1"> [<b>-n</b> </span><span class="s2">table_number</span><span class="s1">]</span></p>
<p class="p1"><span class="s1"><span class="space">          </span>[<b>-v</b> </span><span class="s2">table_value</span><span class="s1">] [<b>-x</b> </span><span class="s2">offset</span><span class="s1">] [<b>-p</b>] [<b>-4</b>] [<b>-6</b>] [<b>-r</b> </span><span class="s2">bstfiles</span><span class="s1">]</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span><b>ipup</b> [<b>-h</b>] <b>-q</b> </span><span class="s2">CC</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span><b>ipdb</b> &lt;</span><span class="s2">outnamebase</span><span class="s1">&gt; &lt;</span><span class="s2">datafile1</span><span class="s1">&gt; &lt;</span><span class="s2">datafile2</span><span class="s1">&gt; &lt;</span><span class="s2">datafile3</span><span class="s1">&gt; ...</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span><b>ipdb-update.sh</b> [&lt;</span><span class="s2">ftp.RIR__mirror_name.net</span><span class="s1">&gt;]</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><b>DESCRIPTION</b></span></p>
<p class="p1"><span class="s1"><span class="space">     </span>In general, routing is determined by destination IP addresses, and access</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>control by the firewall is established by selectors that can be attrib-</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>uted to incoming and outgoing IP packets, like physical interfaces on</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>which the packets are going, source and target IP addresses, protocol</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>types, port numbers, content types and content, etc. The Geo-location</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>would be just another selector, but this information is not carried</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>explicitly with IP packets, however, it can be obtained using an IP</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>address as a key for looking-up the location in an IP database. For exam-</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>ple the country to which a given IP address is delegated, can be obtained</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>with the common Unix tool <b>whois</b>(1).</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span><b>whois</b> does an online look-up in the IP databases of the 5 <b>R</b>egional <b>I</b>nter-</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>net <b>R</b>egistries (AFRINIC, APNIC, ARIN, LACNIC, RIPENCC), and this is the</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>most reliable way to obtain the country code for a given IP address,</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>because the <b>RIR</b>'s are the authorities for internet number delegations.</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>Unfortunately, online database look-up is by far too slow for even think-</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>ing about being utilized on the firewall level, where IP packets need to</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>be processed in a microsecond time scale. Therefore, a locally maintained</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>IP Geo-location database is indispensable in the given respect. The Sys-</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>tem's own routing and filtering tables can be configured to do these</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>tasks if there is a source of the appropriate data. The <b>ipdbtools</b>(1) are</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>designed to provide this data and to assist managing and using it.</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>The three tools in the package are:</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">       </span><b>ipup</b><span class="space">            </span>A tool to utilize the IP Geo-location tables to look-up</span></p>
<p class="p1"><span class="s1"><span class="space">                       </span>the country code belonging to an IP address or generate</span></p>
<p class="p1"><span class="s1"><span class="space">                       </span>sorted lists of CIDR compatible IP address/masklen</span></p>
<p class="p1"><span class="s1"><span class="space">                       </span>pairs per country code, formatted as raw CIDR ranges or</span></p>
<p class="p1"><span class="s1"><span class="space">                       </span><b>ipfw</b>(8) table construction directives.</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">       </span><b>ipdb</b><span class="space">            </span>A tool for consolidating the IP address ranges from the</span></p>
<p class="p1"><span class="s1"><span class="space">                       </span>RIR delegation statistics files into binary sorted</span></p>
<p class="p1"><span class="s1"><span class="space">                       </span>tables of IP ranges + country codes, suitable for</span></p>
<p class="p1"><span class="s1"><span class="space">                       </span>direct utilization by the <b>ipup</b> look-up tool. IPv4 and</span></p>
<p class="p1"><span class="s1"><span class="space">                       </span>IPv6 ranges are stored in separate files.</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">       </span><b>ipdb-update.sh</b><span class="space">  </span>A shell script to update the IP Geo-location tables by</span></p>
<p class="p1"><span class="s1"><span class="space">                       </span>downloading the 5 RIR delegation statistics files from</span></p>
<p class="p1"><span class="s1"><span class="space">                       </span>a <b>R</b>egional <b>I</b>nternet <b>R</b>egistry mirror, and invoking <b>ipdb</b></span></p>
<p class="p1"><span class="s1"><span class="space">                       </span>to generate the binary sorted tables. It is suitable</span></p>
<p class="p1"><span class="s1"><span class="space">                       </span>for invocation by cron.</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><b>Setting</b> <b>up</b> <b>the</b> <b>local</b> <b>IP</b> <b>Geo-location</b> <b>tables</b></span></p>
<p class="p1"><span class="s1"><span class="space">     </span>The authoritative IP Geo-location information must be obtained from the 5</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>RIR's, and compiled into an optimized format, suitable for quickly look-</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>ing-up the country codes of given IP addresses. This information is</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>present in so called delegation statistics files on the ftp servers of</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>each RIR, and APNIC, LACNIC and RIPENCC mirror the files of the other</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>RIR's on their servers - as of the date of this writing, ARIN and AFRINIC</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>do not mirror current delegation statistics of the other RIR's.</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>1) Choose one of the three useful mirror sites, depending on where you</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>are located:</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">       </span><b>ftp.ripencc.net</b> <span class="space">  </span>RIPENCC -- Europe and Eurasia [default mirror]</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">       </span><b>ftp.apnic.net</b> <span class="space">    </span>APNIC -- Asia Pacific</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">       </span><b>ftp.lacnic.net</b><span class="space">    </span>LACNIC -- Latin America and Caribbean</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>2) As user root execute the shell script <b>ipdb-update.sh</b> with the chosen</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>mirror as the parameter, for example ftp.apnic.net:</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span># ipdb-update.sh ftp.apnic.net</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>&gt;&gt;&gt;&gt;</span></p>
<p class="p1"><span class="s1"><span class="space">      </span>/usr/local/etc/ipdb/IPRanges/afrinic.md5<span class="space">  </span>100% of <span class="space">  </span>74<span class="space">  </span>B<span class="space">  </span>277 kBps 0s</span></p>
<p class="p1"><span class="s1"><span class="space">      </span>/usr/local/etc/ipdb/IPRanges/afrinic.dat<span class="space">  </span>100% of<span class="space">  </span>397 kB 1330 kBps 0s</span></p>
<p class="p1"><span class="s1"><span class="space">      </span>/usr/local/etc/ipdb/IPRanges/apnic.md5<span class="space">    </span>100% of <span class="space">  </span>73<span class="space">  </span>B<span class="space">  </span>264 kBps 0s</span></p>
<p class="p1"><span class="s1"><span class="space">      </span>/usr/local/etc/ipdb/IPRanges/apnic.dat<span class="space">    </span>100% of 4045 kB 1259 kBps 4s</span></p>
<p class="p1"><span class="s1"><span class="space">      </span>/usr/local/etc/ipdb/IPRanges/arin.md5 <span class="space">    </span>100% of <span class="space">  </span>67<span class="space">  </span>B<span class="space">  </span>246 kBps 0s</span></p>
<p class="p1"><span class="s1"><span class="space">      </span>/usr/local/etc/ipdb/IPRanges/arin.dat <span class="space">    </span>100% of 8160 kB 1270 kBps 7s</span></p>
<p class="p1"><span class="s1"><span class="space">      </span>/usr/local/etc/ipdb/IPRanges/lacnic.md5 <span class="space">  </span>100% of <span class="space">  </span>74<span class="space">  </span>B<span class="space">  </span>274 kBps 0s</span></p>
<p class="p1"><span class="s1"><span class="space">      </span>/usr/local/etc/ipdb/IPRanges/lacnic.dat <span class="space">  </span>100% of 1870 kB 1271 kBps 2s</span></p>
<p class="p1"><span class="s1"><span class="space">      </span>/usr/local/etc/ipdb/IPRanges/ripencc.md5<span class="space">  </span>100% of <span class="space">  </span>74<span class="space">  </span>B<span class="space">  </span>270 kBps 0s</span></p>
<p class="p1"><span class="s1"><span class="space">      </span>/usr/local/etc/ipdb/IPRanges/ripencc.dat<span class="space">  </span>100% of <span class="space">  </span>10 MB 1258 kBps 9s</span></p>
<p class="p1"><span class="s1"><span class="space">      </span>ipdb v1.1.0 (52), Copyright A(C) 2016 Dr. Rolf Jansen</span></p>
<p class="p1"><span class="s1"><span class="space">      </span>Processing RIR data files ...</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">       </span>afrinic.dat<span class="space">  </span>apnic.dat<span class="space">  </span>arin.dat<span class="space">  </span>lacnic.dat<span class="space">  </span>ripencc.dat</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">      </span>Number of processed IP-Ranges = 112602</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>As shown above, this will download the delegation statistics data</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>together with MD5 hashes for integrity checking into the directory</span></p>
<p class="p1"><span class="s1"><span class="space">     </span></span><span class="s2">/usr/local/etc/ipdb/IPRanges/</span><span class="s1">.<span class="space">  </span>Then the <b>ipdb</b> tool will process the data</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>files and generate two binary sorted table (.bst) files, one for the IPv4</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>ranges </span><span class="s2">/usr/local/etc/IPRanges/ipcc.bst.v4</span><span class="s1"> and another one for the IPv6</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>ranges </span><span class="s2">/usr/local/etc/IPRanges/ipcc.bst.v6</span><span class="s1">.</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><b>USAGE</b> <b>AND</b> <b>OPTIONS</b></span></p>
<p class="p1"><span class="s1"><span class="space">     </span><b>Quering</b> <b>the</b> <b>local</b> <b>IP</b> <b>Geo-location</b> <b>tables</b></span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>Use the <b>ipup</b> tool for the various queries:</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span><b>-h</b> <span class="space">      </span>Show the usage instructions.</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>[<b>-r</b> </span><span class="s2">bstfiles</span><span class="s1">]</span></p>
<p class="p1"><span class="s1"><span class="space">              </span>Base path to the binary sorted tables (.v4 and .v6) with the</span></p>
<p class="p1"><span class="s1"><span class="space">              </span>consolidated IP ranges which were generated by the <b>ipdb</b> tool</span></p>
<p class="p1"><span class="s1"><span class="space">              </span>[default: </span><span class="s2">/usr/local/etc/ipdb/IPRanges/ipcc.bst</span><span class="s1">].</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span><b>First</b> <b>usage</b> <b>form</b> -- CC query:</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>&lt;</span><span class="s2">IP_address</span><span class="s1">&gt;</span></p>
<p class="p1"><span class="s1"><span class="space">              </span>IPv4 or IPv6 address for which the country code should be</span></p>
<p class="p1"><span class="s1"><span class="space">              </span>looked-up.</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span><b>Second</b> <b>usage</b> <b>form</b> -- firewall and routing table generation:</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span><b>-t</b> </span><span class="s2">CC:DD:..</span><span class="s1"> | </span><span class="s2">CC=nnnnn:DD=mmmmm:..</span><span class="s1"> | </span><span class="s2">CC:DD=ooooo:EE;..</span><span class="s1"> | </span><span class="s2">""</span></p>
<p class="p1"><span class="s1"><span class="space">              </span>Output all IP address/masklen pairs belonging to the listed</span></p>
<p class="p1"><span class="s1"><span class="space">              </span>countries, given by 2 letter capital country codes, separated by</span></p>
<p class="p1"><span class="s1"><span class="space">              </span>colon. An empty CC list (denoted by "") means any country code. A table</span></p>
<p class="p1"><span class="s1"><span class="space">              </span>value can be assigned per country code in the following manner:</span></p>
<p class="p1"><span class="s1"><span class="space">                </span>-t BR=10000:DE=10100:US:CA:AU=10200.</span></p>
<p class="p1"><span class="s1"><span class="space">              </span>In the case of no assignment, no value [0] or the global value</span></p>
<p class="p1"><span class="s1"><span class="space">              </span>defined by either the -v or the -x option is utilized.</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>[<b>-n</b> </span><span class="s2">table_number</span><span class="s1">]</span></p>
<p class="p1"><span class="s1"><span class="space">              </span>The ipfw table number between 0 and 65534 [default: 0].</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>[<b>-v</b> </span><span class="s2">table_value</span><span class="s1">]</span></p>
<p class="p1"><span class="s1"><span class="space">              </span>A global 32-bit unsigned value for all ipfw table entries</span></p>
<p class="p1"><span class="s1"><span class="space">              </span>[default: no value -&gt; 0].</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>[<b>-x</b> </span><span class="s2">offset</span><span class="s1">]</span></p>
<p class="p1"><span class="s1"><span class="space">              </span>Decimal encode the given </span><span class="s2">CC</span><span class="s1"> and add it to the </span><span class="s2">offset</span><span class="s1"> for comput-</span></p>
<p class="p1"><span class="s1"><span class="space">              </span>ing the table value:</span></p>
<p class="p1"><span class="s1"><span class="space">              </span>value = </span><span class="s2">offset</span><span class="s1"> + ((C1 - 'A')*26 + (C2 - 'A'))*10.</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>[<b>-p</b>] <span class="space">    </span>Plain IP table generation, i.e. without ipfw table construction</span></p>
<p class="p1"><span class="s1"><span class="space">              </span>directives, and any -n, -v and -x flags are ignored in this</span></p>
<p class="p1"><span class="s1"><span class="space">              </span>mode.</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>[<b>-4</b>] <span class="space">    </span>Process only the </span><span class="s2">IPv4</span><span class="s1"> address ranges.</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>[<b>-6</b>] <span class="space">    </span>Process only the </span><span class="s2">IPv6</span><span class="s1"> address ranges.</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span><b>Third</b> <b>usage</b> <b>form</b> -- compute the encoded value of a country code:</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span><b>-q</b> </span><span class="s2">CC</span><span class="s1"><span class="space">    </span>The country code to be encoded (see -x flag above).</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><b>EXAMPLES</b></span></p>
<p class="p1"><span class="s1"><span class="space">     </span>Check whether the IP Geo-location tables are ready by looking-up some</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>addresses using the <b>ipup</b> tool:</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>$ ipup 62.175.157.33</span></p>
<p class="p1"><span class="s1"><span class="space">        </span>62.175.157.33 in 62.174.0.0 - 62.175.255.255 in ES</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>$ ipup 141.33.17.2</span></p>
<p class="p1"><span class="s1"><span class="space">        </span>141.33.17.2 in 141.12.0.0 - 141.80.255.255 in DE</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>$ ipup 99.67.80.80</span></p>
<p class="p1"><span class="s1"><span class="space">        </span>99.67.80.80 in 98.160.0.0 - 99.191.255.255 in US</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>$ ipup 192.168.1.1</span></p>
<p class="p1"><span class="s1"><span class="space">        </span>192.168.1.1 not found</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>$ ipup 2001:0618:85a3:08d3:1319:8a2e:0370:7344</span></p>
<p class="p1"><span class="s1"><span class="space">        </span>2001:0618:85a3:08d3:1319:8a2e:0370:7344 in 2001:618:0:0:0:0:0:0 -</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>2001:618:ffff:ffff:ffff:ffff:ffff:ffff in CH</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><b>Firewall</b> <b>Examples</b></span></p>
<p class="p1"><span class="s1"><span class="space">     </span><b>ipup</b> can be used for Geo-blocking together with <b>ipfw</b>(8). For this pur-</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>pose, <b>ipup</b> would generate tables of CIDR ranges for the selected country</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>codes, and these tables can be directly piped into <b>ipfw</b>(8). The respec-</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>tive configuration script may contain something like:</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>...</span></p>
<p class="p1"><span class="s1"><span class="space">     </span># Allow only web access from DE, BR, US:</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>/usr/local/bin/ipup -t DE:BR:US -n 7 | /sbin/ipfw -q /dev/stdin</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>/sbin/ipfw -q add 70 deny tcp from not table\(7\) to any 80,443 in recv</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>em0 setup</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>...</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span><b>OR</b> vice versa:</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>...</span></p>
<p class="p1"><span class="s1"><span class="space">     </span># Deny web access from certain countries we don't like this week:</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>/usr/local/bin/ipup -t TR:SA:RU:GB -n 66 | /sbin/ipfw -q /dev/stdin</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>/sbin/ipfw -q add 70 allow tcp from not table\(66\) to any 80,443 in recv</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>em0 setup</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>...</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>In the case of a different firewall facility, a plain table (without ipfw</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>directives) can be generated using <b>ipup</b> by specifying the <b>-p</b> flag. The</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>table may be piped into a pre-processing command before being passed</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>to the firewall utility:</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span># Output data in the format of some other fictional firewall:</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>/usr/local/bin/ipup -t FR:ES:PT -x0 | awk '{print "add-filter", $4, $5}'</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span><b>OR</b></span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>/usr/local/bin/ipup -p -t US:CA | while read TABLE NUM ADD ADDR VAL;</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>myfirewall add filter $ADDR value $VAL; done</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><b>Routing</b> <b>Example</b></span></p>
<p class="p1"><span class="s1"><span class="space">     </span><b>ipup</b> is well suited for manipulating the system's routing table by the</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>way of the <b>route</b>(8) utility:</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>...</span></p>
<p class="p1"><span class="s1"><span class="space">     </span># Force packets to Austria to take a different route:</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>/usr/local/bin/ipup -p -t AT | while read LINE ; do /sbin/route add $LINE</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>$SOMEROUTER; done</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>...</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><b>Cronjob</b> <b>for</b> <b>keeping</b> <b>the</b> <b>IP</b> <b>Geo-location</b> <b>tables</b> <b>updated</b></span></p>
<p class="p1"><span class="s1"><span class="space">     </span><b>ipdb-update.sh</b> may be executed by a weekly (perhaps daily) cronjob, for</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>this you might want to add the following entry to /etc/crontab:</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>...</span></p>
<p class="p1"><span class="s1"><span class="space">     </span># Weekly update of the IP Geo-location tables</span></p>
<p class="p1"><span class="s1"><span class="space">       </span>5<span class="space">    </span>4<span class="space">    </span>*<span class="space">    </span>*<span class="space">    </span>6<span class="space">    </span>root<span class="space">    </span>/usr/local/bin/ipdb-update.sh</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>ftp.apnic.net &gt; /dev/null 2&gt;&amp;1 &amp;&amp; /fullpath/to/fw_or_router_reinit_script</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>...</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><b>FILES</b></span></p>
<p class="p1"><span class="s1"><span class="space">     </span>/usr/local/etc/IPRanges/</span></p>
<p class="p1"><span class="s1"><span class="space">          </span>directory for maintaining the IP Geo-location tables</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>/usr/local/etc/IPRanges/ipcc.bst.v4</span></p>
<p class="p1"><span class="s1"><span class="space">          </span>binary (</span><span class="s2">uint32_t</span><span class="s1">) sorted table of IPv4 ranges and its country codes</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>/usr/local/etc/IPRanges/ipcc.bst.v6</span></p>
<p class="p1"><span class="s1"><span class="space">          </span>binary (</span><span class="s2">uint128_t</span><span class="s1">) sorted table of IPv6 ranges and its country codes</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><b>SEE</b> <b>ALSO</b></span></p>
<p class="p1"><span class="s1"><span class="space">     </span>whois(1), ipfw(8), route(8)</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>in Ports: ip2cc(1), IP::Country(3)</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><b>AUTHOR</b></span></p>
<p class="p1"><span class="s1"><span class="space">     </span>Dr. Rolf Jansen - Copyright (c) 2016 - all rights reserved.</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><b>IMPORTANT</b> <b>NOTE</b></span></p>
<p class="p1"><span class="s1"><span class="space">     </span>Improper use of the <b>ipdb</b> <b>tools</b> may result in erroneous IP tables, and a</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>firewall may be rendered non-functional once configured with incorrect</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>tables.</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="space">     </span>In NO event shall the author and/or copyright owner be liable for ANY</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>damages resulting from ANY use of this software. Use the <b>ipdb</b> <b>tools</b> at</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>your own risk!</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><b>BUGS</b></span></p>
<p class="p1"><span class="s1"><span class="space">     </span>The <b>ipdb</b> <b>tools</b> have been carefully developed and tested. Anyway the tools</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>are provided without any expressed or implied warrantee of being 100 %</span></p>
<p class="p1"><span class="s1"><span class="space">     </span>bug free.</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">FreeBSD, Darwin <span class="space">                </span>August 10, 2016<span class="space">                </span>FreeBSD, Darwin</span></p>
</body>
</html>
